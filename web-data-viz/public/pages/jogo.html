<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Village Craft | Jogo</title>
        <link rel="stylesheet" href="../css/style.css">
        <link rel="stylesheet" href="../css/jogo.css">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
        <style>
            canvas {
                -moz-user-select: none;
                -webkit-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }
        </style>
    </head>
    <body>
        <div class="header">
            <div class="container">
                <img src="../images/villageCraftExt.png" alt="VillageCraft">
                <div class="navbar">
                    <a href="./home.html">Home</a>
                    <a href="./chat.html">Assuntos</a>
                    <a href="./quiz.html">Quizzes</a>
                    <a href="./jogo.html" class="pagina_atual">Jogo</a>
                    <a href="./perfil.html">Perfil</a>
                    <a href="./index.html" class="exit">Sair</a>
                </div>
            </div>
        </div>
        <div class="headerTransition"></div>
        <div class="content">
            <div class="container" id="container">
                <span class="title">Jogo</span>
                <div class="section">
                    <span class="subtitle">Tutorial</span>
                    <p>Lorem ipsum dolor sit, amet consectetur adipisicing elit. Tempore, hic natus. Harum delectus aperiam officiis suscipit. Iure voluptas, velit molestias delectus sit nam ducimus nostrum officia recusandae consequuntur doloremque ad. Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quos unde dolores corporis eveniet repellendus placeat maiores vero labore consequuntur vitae nulla dolorum eos, iure perspiciatis fugit impedit praesentium voluptatem maxime. <br> Lorem ipsum dolor sit amet consectetur adipisicing elit. Ipsum ullam totam voluptates perferendis harum perspiciatis libero necessitatibus beatae accusamus iusto eligendi voluptate animi, natus amet fuga, quis dolorem, facere aliquam?</p>
                </div>
                <div class="section">
                    <span class="subtitle">Escolha um Modo</span>
                    <div class="box">
                        <button onclick="load_word('easy')">Fácil</button>
                        <button onclick="load_word('medium')">Médio</button>
                        <button onclick="load_word('hard')">Difícil</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="footerTransition"></div>
        <div class="footer">
            <div class="container">
                <div class="box">
                    <a href="./index.html" class="navigation">Início</a>
                    <a href="./sobremim.html" class="navigation">Sobre Mim</a>
                    <a href="./cadastro.html" class="navigation">Cadastro</a>
                    <a href="./login.html" class="navigation">Login</a>
                </div>
                <img src="../images/villageCraft.png" alt="VillageCraft" class="footerLogo">
            </div>
        </div>
        <div class="footerCopyright">
            <span class="copyright">&copy; 2024 - Desenvolvido por Fabricio Prudente Ferreira | RA: 04241070 | 1-CCO/A | Faculdade São Paulo Tech School</span>
        </div>
    </body>
</html>
<script>
    var palavras_5 = [
        'ZUMBI',
        'SLIME',
        'PANDA',
        'STEVE',
        'BURRO',
        'BRUXA',
        'PORCO',
        'STRAY',
        'TRAÇA',
        'GHAST',
        'BLAZE',
        'DISCO',
        'ENDER',
        'SELVA',
        'TERRA',
        'CORAL',
        'CRAFT',
        'COBRE',
        'PORTA',
        'TOCHA',
        'CACTO',
        'PRETO',
        'VERDE',
        'VIDRO',
        'SCULK',
        'BLOCO',
        'AREIA',
        'ATRIL',
        'PEDRA',
        'TÁBUA',
        'PLACA',
        'ALLAY',
        'CABRA',
        'BALDE',
        'CARNE',
        'LINHA',
        'BESTA',
        'LIVRO',
        'TRIGO',
        'FERRO',
        'PEIXE',
        'TOTEM',
        'PAPEL',
        'POÇÃO',
        'FUNGO',
        'TAIGA',
        'PRAIA',
        'BARCO',
        'CHAMA',
        'GRAMA',
        'REGRA',
        'CINZA',
        'CIANO'
    ]

    var palavras_6 = [
        'ALDEÃO',
        'ESPADA',
        'TRONCO',
        'VARETA',
        'PIGLIN',
        'RAVINA',
        'EJETOR',
        'WARDEN', 
        'PIGLIN',
        'OVELHA',
        'MARROM',
        'ESCAMA',
        'COELHO',
        'BREEZE',
        'SALMÃO',
        'CAVALO',
        'TULIPA',
        'TRILHO',
        'HOGLIN',
        'CAMELO',
        'TEMPLO',
        'GIRINO',
        'MANSÃO',
        'RUÍNAS',
        'REBOLO',
        'PEPITA',
        'NETHER',
        'PORTAL',
        'COLINA',
        'ALDEIA',
        'QUADRO',
        'BAIACU',
        'ESCUDO',
        'CARVÃO',
        'FLECHA',
        'PODZOL',
        'TUNDRA',
        'PASTOR',
        'ARANHA',
        'RAPOSA',
        'CIDADE',
        'ABELHA',
        'ZOGLIN',
        'WITHER',
        'PIGMAN',
        'BATATA',
        'BRANCO',
        'FÓSSIL',
        'PEÔNIA',
        'BARRIL',
        'FRASCO',
        'LUNETA',
        'SAVANA',
        'ÁRVORE',
        'CRÂNIO',
        'ENXADA',
        'OCEANO',
        'VINHAS',
        'CONCHA',
        'RAJADA'
    ]

    var palavras_7 = [
        'CREEPER',
        'AMARELO',
        'COMANDO',
        'PHANTOM',
        'SHULKER',
        'STRIDER',
        'ANDAIME',
        'LARANJA',
        'MAGENTA',
        'PINTURA',
        'MORCEGO',
        'JUMENTO',
        'AXOLOTE',
        'CORANTE',
        'AFOGADO',
        'GALINHA',
        'PÂNTANO',
        'DESERTO',
        'CLÉRIGO',
        'ARMEIRO',
        'ABÓBORA',
        'AZULEJO',
        'LAMPIÃO',
        'PÓLVORA',
        'MADEIRA',
        'ALÇAPÃO',
        'CAVEIRA',
        'COLMEIA',
        'RELÓGIO',
        'BÚSSOLA',
        'CENOURA',
        'MACHADO',
        'TESOURA',
        'TESOURO',
        'BASALTO',
        'PAPOULA',
        'FORTUNA',
        'REMENDO',
        'IMPACTO',
        'AFIAÇÃO',
        'GRAVETO'
    ];

    var palavra = "";
    var lista = undefined;

    var lista_repetidos = [];
    var lista_cont_certas = [];
    var lista_cont_semicertas = [];
    var lista_cont_erradas = [];
    var lista_tentativas = [];
    
    function load_word(dificuldade){
        if(dificuldade == 'easy') lista = palavras_5;
        else if(dificuldade == 'medium') lista = palavras_6;
        else lista = palavras_7;

        container.innerHTML = "";

        var min = 0;
        var max = lista.length - 1;
        var intervalo = max - min;
        
        var random = (Math.random().toFixed(2) * intervalo).toFixed(0);
        palavra = lista[random];

        container.innerHTML = `
            <div class='game'>
                <div id='letters'></div>
                <div id='keyboard'>
                    <div class='kbLine'>
                        <button onclick='letra("Q")' id='letraQ'>Q</button>
                        <button onclick='letra("W")' id='letraW'>W</button>
                        <button onclick='letra("E")' id='letraE'>E</button>
                        <button onclick='letra("R")' id='letraR'>R</button>
                        <button onclick='letra("T")' id='letraT'>T</button>
                        <button onclick='letra("Y")' id='letraY'>Y</button>
                        <button onclick='letra("U")' id='letraU'>U</button>
                        <button onclick='letra("I")' id='letraI'>I</button>
                        <button onclick='letra("O")' id='letraO'>O</button>
                        <button onclick='letra("P")' id='letraP'>P</button>
                    </div>  
                    <div class='kbLine'>
                        <button onclick='letra("A")' id='letraA'>A</button>
                        <button onclick='letra("S")' id='letraS'>S</button>
                        <button onclick='letra("D")' id='letraD'>D</button>
                        <button onclick='letra("F")' id='letraF'>F</button>
                        <button onclick='letra("G")' id='letraG'>G</button>
                        <button onclick='letra("H")' id='letraH'>H</button>
                        <button onclick='letra("J")' id='letraJ'>J</button>
                        <button onclick='letra("K")' id='letraK'>K</button>
                        <button onclick='letra("L")' id='letraL'>L</button>
                    </div> 
                    <div class='kbLine'>
                        <button onclick='letra("Z")' id='letraZ'>Z</button>
                        <button onclick='letra("X")' id='letraX'>X</button>
                        <button onclick='letra("C")' id='letraC'>C</button>
                        <button onclick='letra("V")' id='letraV'>V</button>
                        <button onclick='letra("B")' id='letraB'>B</button>
                        <button onclick='letra("N")' id='letraN'>N</button>
                        <button onclick='letra("M")' id='letraM'>M</button>
                    </div> 
                    <button onclick='tentativa()' id='btn_tentar'>Tentar</button>
                    <button onclick='voltar()' id='btn_voltar'></
                </div>
            </div>
            <div id='resultado'></div>
        `;

        var lettersContent = "";
        var desativado = '';

        for(var cont = 0; cont < 8; cont++){
            var cor_de_fundo = '#666';

            if(cont >= 1) {
                desativado = 'disabled';
                cor_de_fundo = "#333"
            }

            lettersContent += `<div class='inputsLine' id='inputsLine${cont}'>`;

            for(var index = 0; index < palavra.length; index++){
                lettersContent += `
                    <input 
                        maxlength='1'
                        id='letra-${cont}.${index}' 
                        ${desativado}
                        oninput='changeInput(${index})'
                        style="background-color: ${cor_de_fundo};">
                `;
            }
            lettersContent += `</div>`;
            
        }

        letters.innerHTML = lettersContent;

        document.getElementById('letra-0.0').focus();
    }

    function letra(letra){
        var aux = "";

        for(var cont = 0; cont < palavra.length; cont++){
            var element_value = document.getElementById(`letra-${tentativas}.${cont}`).value;
            
            if(element_value != "") aux += element_value;
        }
        
        if(aux.length < palavra.length) document.getElementById(`letra-${tentativas}.${aux.length}`).value = letra;
    }

    var lista_caracteres_possiveis = [];

    function changeInput(index){
        var element = document.getElementById(`letra-${tentativas}.${index}`);
        var valor = element.value.toUpperCase();
        var nextElement = document.getElementById(`letra-${tentativas}.${index + 1}`);
        var btnTentar = document.getElementById('btn_tentar');

        if(index < palavra.length - 1 && nextElement.value.length == 0) nextElement.focus();
        else if(index == palavra.length - 1) btnTentar.focus();

        if(valor == 'Á' || valor == 'Ã' || valor == 'Â' || valor == 'À') element.value = 'A';
        else if(valor == 'Ç') element.value = 'C';
        else if(valor == 'É' || valor == 'Ê') element.value = 'E';
        else if(valor == 'Í') element.value = 'I';
        else if(valor == 'Ó' || valor == 'Õ' || valor == 'Ô') element.value = 'O';
        else if(valor == 'Ú' || valor == 'Ü') element.value = 'U';
        else if(valor == 'Ñ') element.value = 'N';
    }

    var palavra_formada = "";
    var validado = false;
    var tentativas = 0;

    function tentativa(){
        validado = false;
        palavra_formada = "";

        for(var index = 0; index < palavra.length; index++){
            palavra_formada += document.getElementById(`letra-${tentativas}.${index}`).value;
        }
        
        palavra_formada = palavra_formada.toUpperCase();
        
        detectar_especiais();

        if(validado && lista_repetidos.indexOf(palavra_formada) == -1){
            var cont_acertos = 0;
            var cont_semiacertos = 0;
            var cont_erros = 0;

            for(var index = 0; index < palavra.length; index++){
                var elemento = document.getElementById(`letra-${tentativas}.${index}`);
                var valor = palavra_formada[index];

                if(valor == palavra[index]) {
                    elemento.style.backgroundColor = 'lime';
                    cont_acertos++;
                }
                else if(palavra.indexOf(valor) != -1) {
                    elemento.style.backgroundColor = 'gold';
                    cont_semiacertos++;
                }
                else 
                {
                    elemento.style.backgroundColor = 'red';
                    cont_erros++;
                }
                
                document.getElementById(`letra-${tentativas}.${index}`).value = palavra_formada[index];
            }

            lista_cont_certas.push(cont_acertos);
            lista_cont_semicertas.push(cont_semiacertos);
            lista_cont_erradas.push(cont_erros);
            lista_tentativas.push(`Tentativa ${tentativas + 1}`);

            if(palavra_formada == palavra) {
                alert('Parabéns');

                for(var cont = 0; cont < palavra.length; cont++){
                    document.getElementById(`letra-${tentativas}.${cont}`).disabled = true;
                }

                gerar_grafico();
            }
            else {
                tentativas++;
                
                if(tentativas < 8){
                    for(var cont = 0; cont < palavra.length; cont++){
                        document.getElementById(`letra-${tentativas}.${cont}`).disabled = false;
                        document.getElementById(`letra-${tentativas}.${cont}`).style.backgroundColor = '#666';
                        document.getElementById(`letra-${tentativas - 1}.${cont}`).disabled = true;
                    }
    
                    document.getElementById(`letra-${tentativas}.0`).focus();
                    
                    lista_repetidos.push(palavra_formada);
                }
                else gerar_grafico();
            }
            
        }
        else {
            for(var index = 0; index < palavra.length; index++){
                document.getElementById(`letra-${tentativas}.${index}`).value = "";
            }

            if(lista_repetidos.indexOf(palavra_formada) > -1) alert("Palavra repetida");
            else alert('Palavra inválida');

            document.getElementById(`letra-${tentativas}.0`).focus();
        }
    }

    function detectar_especiais(){
        if(lista == palavras_5) {
            if(palavra_formada == 'TRACA') palavra_formada = "TRAÇA";
            else if(palavra_formada == 'TABUA') palavra_formada = "TÁBUA";
            else if(palavra_formada == 'POCAO') palavra_formada = "POÇÃO";
        } else if(lista == palavras_6) {
            if(palavra_formada == 'ALDEAO') palavra_formada = "ALDEÃO";
            else if(palavra_formada == 'MANSAO') palavra_formada = "MANSÃO";
            else if(palavra_formada == 'CARVAO') palavra_formada = "CARVÃO";
            else if(palavra_formada == 'RUINAS') palavra_formada = "RUÍNAS";
            else if(palavra_formada == 'FOSSIL') palavra_formada = "FÓSSIL";
            else if(palavra_formada == 'PEONIA') palavra_formada = "PEÔNIA";
            else if(palavra_formada == 'SALMAO') palavra_formada = "SALMÃO";
        } else {
            if(palavra_formada == 'LAMPIAO') palavra_formada = "LAMPIÃO";
            else if(palavra_formada == 'PANTANO') palavra_formada = "PÂNTANO";
            else if(palavra_formada == 'ALCAPAO') palavra_formada = "ALÇAPÃO";
            else if(palavra_formada == 'POLVORA') palavra_formada = "PÓLVORA";
            else if(palavra_formada == 'CLERIGO') palavra_formada = "CLÉRIGO";
            else if(palavra_formada == 'ABOBORA') palavra_formada = "ABÓBORA";
            else if(palavra_formada == 'RELOGIO') palavra_formada = "RELÓGIO";
            else if(palavra_formada == 'BUSSOLA') palavra_formada = "BÚSSOLA";
            else if(palavra_formada == 'AFIACAO') palavra_formada = "AFIAÇÃO";
        }
        
        
        var indice = lista.indexOf(palavra_formada);
        if(indice != -1) validado = true;
    }

    function gerar_grafico(){
        var alfabeto = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';

        for(var cont = 0; cont < alfabeto.length; cont++){
            var btnLetra = document.getElementById(`letra${alfabeto[cont]}`);
            btnLetra.style.backgroundColor = '#333';
            btnLetra.disabled = true;
            btnLetra.style.cursor = 'auto';
        }

        document.getElementById('btn_tentar').disabled = true;
        document.getElementById('btn_tentar').style.backgroundColor = '#333';
        document.getElementById('btn_tentar').style.cursor = 'auto';

        document.getElementById('resultado').style.display = 'flex';

        resultado.innerHTML += `
            <span class='subtitle'>PALAVRA: ${palavra}</span>
            <div class='graficos'>
                <section>
                    <canvas id='tentativas'>
                </section>
                <section>
                    <canvas id='total'>
                </section>
            </div>
        `;

        var tentativasCanvas = document.getElementById('tentativas').getContext('2d');
        tentativasCanvas.canvas.parentNode.style.width = '1250px';
        tentativasCanvas.canvas.parentNode.style.height = '500px';
        tentativasCanvas.canvas.width = 2.5;
        tentativasCanvas.canvas.height = 1;

        var graficotentativasCanvas = new Chart(
            tentativasCanvas,
            {
                type: 'bar',
                data: {
                    labels: lista_tentativas,
                    datasets: [{
                        data: lista_cont_certas,
                        backgroundColor: ['lime'],
                        label: 'Letras Corretas'
                    }, {
                        data: lista_cont_erradas,
                        backgroundColor: ['#f00'],
                        label: 'Letras Erradas'
                    }, {
                        data: lista_cont_semicertas,
                        backgroundColor: ['gold'],
                        label: 'Letras Semi-Corretas'
                    }]
                },
                options: {
                    scales: {
                        x: {
                            border: {
                                color: 'white'
                            },
                            title: {
                                display: true,
                                text: 'Tentativas',
                                color: '#ccc',
                                font: {
                                    size: 20,
                                    family: 'pixel-font'
                                }
                            },
                            ticks: {
                                color: '#ccc',
                                font: {
                                    family: 'pixel-font',
                                    size: 15
                                }
                            },
                            grid: {
                                color: '#666',
                                tickColor: 'white'
                            }
                        },
                        y: {
                            min: 0,
                            max: palavra.length,
                            ticks: {
                                stepSize: 1,
                                color: '#ccc',
                                font: {
                                    family: 'pixel-font',
                                    size: 15
                                }
                            },
                            grid: {
                                color: '#666',
                                tickColor: 'white'
                            },
                            border: {
                                color: 'white'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Taxa de Acertos',
                            color: 'white',
                            font: {
                                family: 'pixel-font',
                                size: 60
                            }
                        },
                        legend: {
                            display: true,
                            position: 'bottom',
                            align: 'center',
                            minHeight: 350,
                            labels: {
                                color: '#ccc',
                                padding: 40,
                                boxWidth: 60,
                                font: {
                                    family: 'pixel-font',
                                    size: 20
                                }
                            }
                        }
                    }
                }
            }
        )

        var totalCanvas = document.getElementById('total').getContext('2d');
        totalCanvas.canvas.parentNode.style.width = '1250px';
        totalCanvas.canvas.parentNode.style.height = '500px';
        totalCanvas.canvas.width = 2.5;
        totalCanvas.canvas.height = 1;

        var total_acertos = 0;
        var total_semiacertos = 0;
        var total_erros = 0;
        
        for(var index = 0; index < lista_tentativas.length; index++){
            total_acertos += lista_cont_certas[index];
            total_semiacertos += lista_cont_semicertas[index];
            total_erros += lista_cont_erradas[index];
        }

        var graficoTotalCanvas = new Chart(
            totalCanvas,
            {
                type: 'pie',
                data: {
                    labels: ['Acertos', 'Erros', 'Semiacertos'],
                    datasets: [{
                        data: [total_acertos, total_erros, total_semiacertos],
                        backgroundColor: ['lime', 'red', 'gold'],
                    }]
                },
                options: {
                    plugins: {
                        title: {
                            display: true,
                            text: 'Total de Acertos',
                            color: 'white',
                            font: {
                                family: 'pixel-font',
                                size: 60
                            }
                        },
                        legend: {
                            display: true,
                            position: 'bottom',
                            align: 'center',
                            minHeight: 350,
                            labels: {
                                color: '#ccc',
                                padding: 30,
                                boxWidth: 40,
                                font: {
                                    family: 'pixel-font',
                                    size: 20
                                }
                            }
                        }
                    }
                }
            }
        )
    }
</script>