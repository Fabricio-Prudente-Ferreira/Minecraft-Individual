<!DOCTYPE html>
<html lang="en">
    <head>
        <link rel="shortcut icon" href="./images/villageCraft.png" type="image/x-icon">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Village Craft | Home</title>
        <link rel="stylesheet" href="../css/style.css">
        <link rel="stylesheet" href="../css/home.css">
        <script src="../js/sessao.js"></script>
        <script src="../js/chartJsIndex.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
        <style>
            canvas {
                -moz-user-select: none;
                -webkit-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }
        </style>
    </head>
    <body>
        <div class="header">
            <div class="container">
                <img src="../images/villageCraftExt.png" alt="VillageCraft">
                <div class="navbar">
                    <a href="./home.html" class="pagina_atual">Home</a>
                    <a href="./chat.html">Chats</a>
                    <a href="./quiz.html">Quizzes</a>
                    <a href="./termo.html">Termo</a>
                    <a href="./perfil.html">Perfil</a>
                    <a onclick="limparSessao()" class="exit">Sair</a>
                </div>
            </div>
        </div>
        <div class="indexIntroduction">
            <img src="../images/villageCraft.png" alt="VillageCraft">
            <img src="../images/imagens/moon.png" alt="moon" class="moon">
        </div>
        <div class="headerTransition"></div>
        <div class="content">
            <div class="container">
                <span class="title">SEJA BEM-VINDO <span id='nick_usuario' class="title">Nickname</span></span>
                <div class="section" id="termo">
                    <span class="subtitle">Pontuações - Termo</span>
                    <div class="graphicsTermo" id="modoFacil">
                        <section>
                            <canvas id="tentativas_termo_facil"></canvas>
                        </section>
                        <section>
                            <canvas id="geral_termo_facil"></canvas>
                        </section>
                    </div>
                    <div class="graphicsTermo meio" id="modoMedio">
                        <section>
                            <canvas id="tentativas_termo_medio"></canvas>
                        </section>
                        <section>
                            <canvas id="geral_termo_medio"></canvas>
                        </section>
                    </div>
                    <div class="graphicsTermo" id="modoDificil">
                        <section>
                            <canvas id="tentativas_termo_dificil"></canvas>
                        </section>
                        <section>
                            <canvas id="geral_termo_dificil"></canvas>
                        </section>
                    </div>
                </div>
                <div class="section" id="quiz">
                    <span class="subtitle">Pontuações - Quizzes</span>
                    <div class="boxQuizGraphic">
                        <div class="graphicsQuiz" id="div_geral">
                            <section>
                                <canvas id="tentativas_quiz_geral"></canvas>
                            </section>
                        </div>
                        <div class="graphicsQuiz" id="div_minerios">
                            <section>
                                <canvas id="tentativas_quiz_minérios"></canvas>
                            </section>
                        </div>
                    </div>
                    <div class="boxQuizGraphic">
                        <div class="graphicsQuiz" id="div_redstone">
                            <section>
                                <canvas id="tentativas_quiz_redstone"></canvas>
                            </section>
                        </div>
                        <div class="graphicsQuiz" id="div_mobs">
                            <section>
                                <canvas id="tentativas_quiz_mobs"></canvas>
                            </section>
                        </div>
                    </div>
                    <div class="boxQuizGraphic">
                        <div class="graphicsQuiz" id="div_blocos">
                            <section>
                                <canvas id="tentativas_quiz_blocos"></canvas>
                            </section>
                        </div>
                        <div class="graphicsQuiz" id="div_itens">
                            <section>
                                <canvas id="tentativas_quiz_itens"></canvas>
                            </section>
                        </div>
                    </div>
                    <div class="boxQuizGraphic">
                        <div class="graphicsQuiz" id="div_encantamentos">
                            <section>
                                <canvas id="tentativas_quiz_encantamentos"></canvas>
                            </section>
                        </div>
                        <div class="graphicsQuiz" id="div_biomas">
                            <section>
                                <canvas id="tentativas_quiz_biomas"></canvas>
                            </section>
                        </div>
                    </div>
                    <div class="boxQuizGraphic">
                        <div class="graphicsQuiz" id="div_pocoes">
                            <section>
                                <canvas id="tentativas_quiz_poções"></canvas>
                            </section>
                        </div>
                        <div class="graphicsQuiz" id="div_estruturas">
                            <section>
                                <canvas id="tentativas_quiz_estruturas"></canvas>
                            </section>
                        </div>
                    </div>
                    <div class="boxQuizGraphic">
                        <div class="graphicsQuiz" id="div_crafts">
                            <section>
                                <canvas id="tentativas_quiz_crafts"></canvas>
                            </section>
                        </div>
                        <div class="graphicsQuiz" id="div_comercio">
                            <section>
                                <canvas id="tentativas_quiz_comércio"></canvas>
                            </section>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="footerTransition"></div>
        <div class="footer">
            <div class="container">
                <div class="containerBox">
                    <div class="box">
                        <span class="subtitleFooter">Páginas</span>
                        <a href="./home.html" class="navigation">Home</a>
                        <a href="./chat.html" class="navigation">Chats</a>
                        <a href="./quiz.html" class="navigation">Quizzes</a>
                        <a href="./termo.html" class="navigation">Termo</a>
                        <a href="./perfil.html" class="navigation">Perfil</a>
                    </div>
                    <div class="box">
                        <span class="subtitleFooter">Contatos:</span>
                        <span>fabricio-ferreira@sptech.school</span>
                        <span>(11) 14074-8989</span>
                        <span>Rua Haddock Lobo, 595, São Paulo - SP</span>
                    </div>
                </div>
                <div class="containerImg">
                    <img src="../images/villageCraft.png" alt="VillageCraft">
                </div>
            </div>
        </div>
        <div class="footerCopyright">
            <span class="copyright">&copy; 2024 - Desenvolvido por Fabricio Prudente Ferreira | RA: 04241070 | 1-CCO/A | Faculdade São Paulo Tech School</span>
        </div>
    </body>
</html>
<script>
    window.onload = validarSessao();

    /* ============================ CARREGAR PONTUAÇÃO ============================ */

    //TERMO
    var pontuacoes_facil = [];
    var pontuacoes_medio = [];
    var pontuacoes_dificil = [];

    var lista_tentativas_facil = [];
    var lista_tentativas_medio = [];
    var lista_tentativas_dificil = [];

    var lista_cores_facil = [];
    var lista_cores_medio = [];
    var lista_cores_dificil = [];

    var cont_tentativas_facil = 0;
    var cont_tentativas_medio = 0;
    var cont_tentativas_dificil = 0;

    var vitorias_facil = 0;
    var vitorias_medio = 0;
    var vitorias_dificil = 0;

    fetch("../pontuacao/termo", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify({
            idUsuarioServer: sessionStorage.ID_USUARIO
        }),
    })
    .then(function(resposta){
        if(resposta.ok){
            resposta.json().then(function(respostaJson){
                var facil_validacao = false;
                var medio_validacao = false;
                var dificil_validacao = false;

                for(var index = 0; index < respostaJson.modo.length; index++){
                    var cor = "";
                    var dificuldade = respostaJson.modo[index];
                    var palavra = respostaJson.palavra[index];
                    var vitoria = respostaJson.resultado[index];
                    var qtd_tentativas = respostaJson.qtdTentativas[index];

                    if(vitoria) cor = "#48d348";
                    else cor = '#004455';

                    if(dificuldade == 'Fácil') {
                        if(vitoria) vitorias_facil++;
                        facil_validacao = true;
                        cont_tentativas_facil++;
                        lista_tentativas_facil.push(`Tent. ${cont_tentativas_facil} - ${palavra}`);
                        pontuacoes_facil.push(qtd_tentativas);
                        lista_cores_facil.push(cor);
                    }
                    else if(dificuldade == 'Médio') {
                        if(vitoria) vitorias_medio++;
                        medio_validacao = true;
                        cont_tentativas_medio++;
                        lista_tentativas_medio.push(`Tent. ${cont_tentativas_medio} - ${palavra}`);
                        pontuacoes_medio.push(qtd_tentativas);
                        lista_cores_medio.push(cor);
                    }
                    else {
                        if(vitoria) vitorias_dificil++;
                        dificil_validacao = true;
                        cont_tentativas_dificil++
                        lista_tentativas_dificil.push(`Tent. ${cont_tentativas_dificil} - ${palavra}`);
                        pontuacoes_dificil.push(qtd_tentativas);
                        lista_cores_dificil.push(cor);
                    }
                }

                if(facil_validacao) chartjs_termo_facil();
                else modoFacil.innerHTML = "<span class='aviso'>Você ainda não jogou o modo fácil do Termo. <a href='./termo.html'>Clique aqui para jogar!</a></span>";
                
                if(medio_validacao) chartjs_termo_medio();
                else modoMedio.innerHTML = "<span class='aviso'>Você ainda não jogou o modo médio do Termo. <a href='./termo.html'>Clique aqui para jogar!</a></span>";

                if(dificil_validacao) chartjs_termo_dificil();
                else modoDificil.innerHTML = "<span class='aviso'>Você ainda não jogou o modo difícil o Termo. <a href='./termo.html'>Clique aqui para jogar!</a></span>";
            })
        } else {
            termo.innerHTML = `
                <span class="subtitle">Pontuações - Termo</span>
                <span class='aviso'>Você ainda não jogou o Termo. <a href='./termo.html'>Clique aqui para jogar!</a></span>
            `;
        }
    })
    .catch(function(erro){
        console.error(erro);
    })

    var pontAllData = []; 
    var pontOresData = []; 
    var pontRedsData = []; 
    var pontMobsData = []; 
    var pontBlocksData = []; 
    var pontItemsData = []; 
    var pontEnchantData = []; 
    var pontBiomesData = []; 
    var pontPotionsData = []; 
    var pontStructuresData = []; 
    var pontCraftsData = []; 
    var pontTradesData = []; 

    //QUIZZES
    fetch("../pontuacao/quizzes", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify({
            idUsuarioServer: sessionStorage.ID_USUARIO
        }),
    })
    .then(function(resposta){
        if(resposta.ok){
            resposta.json().then(function(respostaJson){
                pontAllData = respostaJson.pontAll;
                pontOresData = respostaJson.pontOres;
                pontRedsData = respostaJson.pontReds;
                pontMobsData = respostaJson.pontMobs;
                pontBlocksData = respostaJson.pontBlocks;
                pontItemsData = respostaJson.pontItems;
                pontEnchantData = respostaJson.pontEnchant;
                pontBiomesData = respostaJson.pontBiomes;
                pontPotionsData = respostaJson.pontPotions;
                pontStructuresData = respostaJson.pontStructures;
                pontCraftsData = respostaJson.pontCrafts;
                pontTradesData = respostaJson.pontTrades;
                
                if(pontAllData.length >= 1) chartjs_quiz([pontAllData, 'Geral', '#48d348']);
                else quiz_erro_texto(div_geral, 'Geral');

                if(pontOresData.length >= 1) chartjs_quiz([pontOresData, 'Minérios', '#004455']);
                else quiz_erro_texto(div_minerios, 'Minérios');
                
                if(pontRedsData.length >= 1) chartjs_quiz([pontRedsData, 'Redstone', '#48d348']);
                else quiz_erro_texto(div_redstone, 'Redstone');
                
                if(pontMobsData.length >= 1) chartjs_quiz([pontMobsData, 'Mobs', '#004455']);
                else quiz_erro_texto(div_mobs, 'Mobs');
                
                if(pontBlocksData.length >= 1) chartjs_quiz([pontBlocksData, 'Blocos', '#48d348']);
                else quiz_erro_texto(div_blocos, 'Blocos');
                
                if(pontItemsData.length >= 1) chartjs_quiz([pontItemsData, 'Itens', '#004455']);
                else quiz_erro_texto(div_itens, 'Itens');
                
                if(pontEnchantData.length >= 1) chartjs_quiz([pontEnchantData, 'Encantamentos', '#48d348']);
                else quiz_erro_texto(div_encantamentos, 'Encantamentos');
                
                if(pontBiomesData.length >= 1) chartjs_quiz([pontBiomesData, 'Biomas', '#004455']);
                else quiz_erro_texto(div_biomas, 'Biomas');
                
                if(pontPotionsData.length >= 1) chartjs_quiz([pontPotionsData, 'Poções', '#48d348']);
                else quiz_erro_texto(div_pocoes, 'Poções');
                
                if(pontStructuresData.length >= 1) chartjs_quiz([pontStructuresData, 'Estruturas', '#004455']);
                else quiz_erro_texto(div_estruturas, 'Estruturas');
                
                if(pontCraftsData.length >= 1) chartjs_quiz([pontCraftsData, 'Craft', '#48d348']);
                else quiz_erro_texto(div_crafts, 'Crafts');
                
                if(pontTradesData.length >= 1) chartjs_quiz([pontTradesData, 'Comércio', '#004455']);
                else quiz_erro_texto(div_comercio, 'Comércio');
            })
        } else {
            quiz.innerHTML = `
                <span class="subtitle">Pontuações - Quizzes</span>
                <span class='aviso'>Você ainda não jogou os Quizzes. <a href='./quiz.html'>Clique aqui para jogar!</a></span>
            `;
        }
    })
    .catch(function(erro){
        console.error(erro);
    })
</script>