<!DOCTYPE html>
<html lang="en">
    <head>
        <link rel="shortcut icon" href="./images/villageCraft.png" type="image/x-icon">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Village Craft | Home</title>
        <link rel="stylesheet" href="../css/style.css">
        <link rel="stylesheet" href="../css/home.css">
        <script src="../js/sessao.js"></script>
        <script src="../js/chartJsIndex.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
        <style>
            canvas {
                -moz-user-select: none;
                -webkit-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }
        </style>
    </head>
    <body>
        <div class="header">
            <div class="container">
                <img src="../images/villageCraftExt.png" alt="VillageCraft">
                <div class="navbar">
                    <a href="./home.html" class="pagina_atual">Home</a>
                    <a href="./chat.html">Chats</a>
                    <a href="./quiz.html">Quizzes</a>
                    <a href="./termo.html">Termo</a>
                    <a href="./perfil.html">Perfil</a>
                    <a onclick="limparSessao()" class="exit">Sair</a>
                </div>
            </div>
        </div>
        <div class="indexIntroduction">
            <img src="../images/villageCraft.png" alt="VillageCraft">
            <img src="../images/imagens/moon.png" alt="moon" class="moon">
        </div>
        <div class="headerTransition"></div>
        <div class="content">
            <div class="container">
                <span class="title">SEJA BEM-VINDO <span id='nick_usuario' class="title">Nickname</span></span>
                <div class="section">
                    <span class="subtitle">Mobs</span>
                    <div class="box" id="mobsCards"></div>
                    <div id="mobPages"></div>
                </div>
                <div class="section" id="termo">
                    <span class="subtitle">Pontuações - Termo</span>
                    <div class="graphicsTermo" id="modoFacil">
                        <section>
                            <canvas id="tentativas_termo_facil"></canvas>
                        </section>
                        <section>
                            <canvas id="geral_termo_facil"></canvas>
                        </section>
                    </div>
                    <div class="graphicsTermo meio" id="modoMedio">
                        <section>
                            <canvas id="tentativas_termo_medio"></canvas>
                        </section>
                        <section>
                            <canvas id="geral_termo_medio"></canvas>
                        </section>
                    </div>
                    <div class="graphicsTermo" id="modoDificil">
                        <section>
                            <canvas id="tentativas_termo_dificil"></canvas>
                        </section>
                        <section>
                            <canvas id="geral_termo_dificil"></canvas>
                        </section>
                    </div>
                </div>
                <div class="section">
                    <span class="subtitle"></span>
                </div>
            </div>
        </div>
        <div class="footerTransition"></div>
        <div class="footer">
            <div class="container">
                <div class="containerBox">
                    <div class="box">
                        <span class="subtitleFooter">Páginas</span>
                        <a href="./home.html" class="navigation">Home</a>
                        <a href="./chat.html" class="navigation">Chats</a>
                        <a href="./quiz.html" class="navigation">Quizzes</a>
                        <a href="./termo.html" class="navigation">Termo</a>
                        <a href="./perfil.html" class="navigation">Perfil</a>
                    </div>
                    <div class="box">
                        <span class="subtitleFooter">Contatos:</span>
                        <span>fabricio-ferreira@sptech.school</span>
                        <span>(11) 14074-8989</span>
                        <span>Rua Haddock Lobo, 595, São Paulo - SP</span>
                    </div>
                </div>
                <div class="containerImg">
                    <img src="../images/villageCraft.png" alt="VillageCraft">
                </div>
            </div>
        </div>
        <div class="footerCopyright">
            <span class="copyright">&copy; 2024 - Desenvolvido por Fabricio Prudente Ferreira | RA: 04241070 | 1-CCO/A | Faculdade São Paulo Tech School</span>
        </div>
    </body>
</html>
<script>
    window.onload = validarSessao();

    var mobsName = [
        'Abelha',
        'Afogado',
        'Aldeão',
        'Aldeão Zumbi',
        'Allay',
        'Aranha',
        'Aranha de Caverna',
        'Axolote',
        'Bacalhau',
        'Baiacu',
        'Blaze',
        'Bode',
        'Bogged',
        'Boneco de Ferro',
        'Boneco de Neve',
        'Breeze',
        'Bruxa',
        'Burro',
        'Camelo',
        'Cavalo',
        'Cavalo Esqueleto',
        'Coelho',
        'Coguvaca',
        'Creeper',
        'Cubo de Magma',
        'Devastador',
        'Dragão Ender',
        'Enderman',
        'Endermite',
        'Esqueleto',
        'Esqueleto Wither',
        'Galinha',
        'Gato',
        'Ghast',
        'Girino',
        'Golfinho',
        'Guardião',
        'Guardião Ancião',
        'Hoglin',
        'Husk',
        'Invocador',
        'Jaquatirica',
        'Jumento',
        'Lhama',
        'Lobo',
        'Lula',
        'Lula Brilhante',
        'Morcego',
        'Ovelha',
        'Panda',
        'Papagaio',
        'Phantom',
        'Peixe Tropical',
        'Piglin',
        'Piglin Bárbaro',
        'Piglin Zumbi',
        'Porco',
        'Salmão',
        'Sapo',
        'Saqueador',
        'Shulker',
        'Slime',
        'Sniffer',
        'Stray',
        'Strider',
        'Tartaruga',
        'Tatu',
        'Traça',
        'Urso Polar',
        'Vaca',
        'Vingador',
        'Warden',
        'Wither',
        'Zoglin',
        'Zumbi'
    ];

    var cards = [];
    var letras = ['A'];

    var content = "<div class='group'><span style='color: white;'>A</span><div class='cards'>";
    var contCards = 0;
    var pularLinha = false;
    var letra = "A";

    for(var index = 0; index < mobsName.length; index++){
        if(!mobsName[index].startsWith(letra)) {
            letra = mobsName[index][0];
            letras.push(letra);
            pularLinha = true;
        } else pularLinha = false;
        
        if(pularLinha) {
            content += `</div></div>`
            cards.push(content);
            content = `<div class='group'><span style='color: white;'>${letra}</span><div class='cards'>`;
            contCards = 0;
        }
        else if(contCards % 4 == 0) content += `</div><div class='cards'>`;
            
        content += `<button class='card'>${mobsName[index]}</button>`;

        if(index == mobsName.length - 1) { 
            content += `</div></div>`;
            cards.push(content);
        }

        contCards++;
    }

    var pages = "";
    for(var index = 0; index < cards.length; index++){
        pages += `
            <button onclick="mobsCards.innerHTML = cards[${index}]">${letras[index]}</button>
        `
    }

    mobsCards.innerHTML = cards[0];
    mobPages.innerHTML = pages;


    /* ============================ CARREGAR PONTUAÇÃO ============================ */

    var pontuacoes_facil = [];
    var pontuacoes_medio = [];
    var pontuacoes_dificil = [];

    var lista_tentativas_facil = [];
    var lista_tentativas_medio = [];
    var lista_tentativas_dificil = [];

    var lista_cores_facil = [];
    var lista_cores_medio = [];
    var lista_cores_dificil = [];

    var cont_tentativas_facil = 0;
    var cont_tentativas_medio = 0;
    var cont_tentativas_dificil = 0;

    var vitorias_facil = 0;
    var vitorias_medio = 0;
    var vitorias_dificil = 0;

    fetch("../pontuacao/termo", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify({
            idUsuarioServer: sessionStorage.ID_USUARIO
        }),
    })
    .then(function(resposta){
        if(resposta.ok){
            resposta.json().then(function(respostaJson){
                var facil_validacao = false;
                var medio_validacao = false;
                var dificil_validacao = false;

                for(var index = 0; index < respostaJson.modo.length; index++){
                    var cor = "";
                    var dificuldade = respostaJson.modo[index];
                    var palavra = respostaJson.palavra[index];
                    var vitoria = respostaJson.resultado[index];
                    var qtd_tentativas = respostaJson.qtdTentativas[index];

                    if(vitoria) cor = "#48d348";
                    else cor = '#004455';

                    if(dificuldade == 'Fácil') {
                        if(vitoria) vitorias_facil++;
                        facil_validacao = true;
                        cont_tentativas_facil++;
                        lista_tentativas_facil.push(`Tent. ${cont_tentativas_facil} - ${palavra}`);
                        pontuacoes_facil.push(qtd_tentativas);
                        lista_cores_facil.push(cor);
                    }
                    else if(dificuldade == 'Médio') {
                        if(vitoria) vitorias_medio++;
                        medio_validacao = true;
                        cont_tentativas_medio++;
                        lista_tentativas_medio.push(`Tent. ${cont_tentativas_medio} - ${palavra}`);
                        pontuacoes_medio.push(qtd_tentativas);
                        lista_cores_medio.push(cor);
                    }
                    else {
                        if(vitoria) vitorias_dificil++;
                        dificil_validacao = true;
                        cont_tentativas_dificil++
                        lista_tentativas_dificil.push(`Tent. ${cont_tentativas_dificil} - ${palavra}`);
                        pontuacoes_dificil.push(qtd_tentativas);
                        lista_cores_dificil.push(cor);
                    }
                }

                if(facil_validacao) chartjs_termo_facil();
                else modoFacil.innerHTML = "<span class='aviso'>Você ainda não jogou o modo fácil do Termo. <a href='./termo.html'>Clique aqui para jogar!</a></span>";
                
                if(medio_validacao) chartjs_termo_medio();
                else modoMedio.innerHTML = "<span class='aviso'>Você ainda não jogou o modo médio do Termo. <a href='./termo.html'>Clique aqui para jogar!</a></span>";

                if(dificil_validacao) chartjs_termo_dificil();
                else modoDificil.innerHTML = "<span class='aviso'>Você ainda não jogou o modo difícil o Termo. <a href='./termo.html'>Clique aqui para jogar!</a></span>";
            })
        } else {
            termo.innerHTML = `
                <span class="subtitle">Pontuações - Termo</span>
                <span class='aviso'>Você ainda não jogou o Termo. <a href='./termo.html'>Clique aqui para jogar!</a></span>
            `;
        }
    })
    .catch(function(erro){
        console.log(erro);
    })
</script>